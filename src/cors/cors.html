<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <link rel="stylesheet" href="../../css/style.css">
</head>
<body>
    <div id="app">
        <div class="container">
            <div class="form-group">
                <label>Search</label>
                <input type="text" class="search-input" v-model="searchQuery"/>
            </div>
        </div>
        <div class="container">
            <simple-grid :data-list="gridData" :columns="gridColumns" :search-key="searchQuery"></simple-grid>
        </div>
    </div>

    <template id="grid-template">
        <table>
            <thead>
                <tr>
                    <th v-for="col in columns">
                        {{col | capitalize}}
                    </th>
                    <th>
                        Delete
                    </th>
                </tr>
            </thead>
            <tbody>
                <tr v-for="entry in dataList |filterBy searchKey">
                    <td v-for="col in columns">
                        <span v-if="$index == 1">
                            <a href="javascript:void(0)" @click="openEditItemDialog(entry[col])">{{entry[col]}}</a>
                        </span>
                        <span v-else>{{entry[col]}}</span>
                    </td>
                    <td class="text-center">
                        <button class="btn-danger" @click="deleteItem(entry.userId)">delete</button>
                    </td>
                </tr>
            </tbody>
        </table>
    </template>

    <template id="dialog-template">

    </template>

    <script src="../../js/vue.js"></script>
    <script src="../../js/jquery-1.10.2.min.js"></script>
    <script src="../../js/ajax-helper.js"></script>
    <script>
        var dialogTemplate = Vue.extend({
            template: 'dialog-template',
            data: function () {
                return {
                    show: false
                }
            }
        })

        Vue.component('simple-grid',{
            template: '#grid-template',
            props:['dataList','columns','searchKey'],
            data: function() {
                return {

                }
            },
            methods: {
                openEditItemDialog: function (userId) {

                },
                deleteItem: function (userId) {
                    var callback = function (response) {
                        var data = vue.gridData;
                        data.forEach(function (item, i) {
                            if (item.userId === userId) {
                                data.splice(i, 1);
                            }
                        })
                        alert(response.resMsg);
                    }
                    ajaxHelper.get(vue.apiUrl+'/delete/'+userId, null, callback);
                }
            },
            components: {
                'dialog': dialogTemplate
            }
        })

        var ajaxHelper = new AjaxHelper();
        var vue = new Vue({
            el: '#app',
            data: {
                searchQuery: '',
                gridColumns:['userId','userName','password','mobileNo','email'],
                gridData: [],
                apiUrl: 'http://192.168.199.160:8080/user'
            },
            ready: function () {
                this.gridData = this.getUsers();
            },
            methods: {
                getUsers: function () {
                    var vm = this,
                        callback = function (data) {
                            vm.$set('gridData',data.result);
                        };
                    ajaxHelper.get(this.apiUrl+'/findUsers', null, callback);
                }
            }
        })
    </script>
</body>
</html>